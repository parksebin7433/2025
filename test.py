import streamlit as st
import random

# 상의 색상 전체 리스트 (항상 이 9가지가 보이도록)
ALL_TOPS = ["빨강","주황","노랑","초록","파랑","보라","핑크","화이트","검정"]

# 계절 + 스타일별 색상 팔레트 (상의 → 나머지 아이템)
outfit_palette = {
    "봄": {
        "캐주얼": {
            "화이트": {"하의": ["데님 블루", "베이지"], "신발": ["화이트", "핑크"], "가방": ["브라운", "화이트"]},
            "빨강": {"하의": ["화이트", "블랙"], "신발": ["화이트", "블랙"], "가방": ["네이비", "화이트"]},
            "주황": {"하의": ["화이트", "데님 블루"], "신발": ["화이트", "브라운"], "가방": ["화이트", "베이지"]},
            "노랑": {"하의": ["화이트", "네이비"], "신발": ["화이트", "브라운"], "가방": ["브라운", "화이트"]},
            "초록": {"하의": ["화이트", "베이지"], "신발": ["화이트", "브라운"], "가방": ["브라운", "화이트"]},
            "파랑": {"하의": ["화이트", "그레이"], "신발": ["화이트", "블랙"], "가방": ["네이비", "화이트"]},
            "보라": {"하의": ["화이트", "그레이"], "신발": ["화이트", "블랙"], "가방": ["네이비", "실버"]},
            "핑크": {"하의": ["화이트", "그레이"], "신발": ["화이트", "블랙"], "가방": ["네이비", "화이트"]},
            "검정": {"하의": ["화이트", "그레이"], "신발": ["화이트", "레드"], "가방": ["화이트", "실버"]}
        },
        "포멀": {
            "화이트": {"하의": ["블랙", "네이비"], "신발": ["블랙", "실버"], "가방": ["블랙", "네이비"]},
            "검정": {"하의": ["화이트", "그레이"], "신발": ["블랙", "화이트"], "가방": ["실버", "브라운"]},
            "네이비": {"하의": ["화이트", "그레이"], "신발": ["블랙", "브라운"], "가방": ["화이트", "브라운"]},
        },
        "스포츠": {
            "그레이": {"하의": ["블랙", "네이비"], "신발": ["화이트", "민트"], "가방": ["블랙", "그레이"]},
            "화이트": {"하의": ["블랙", "그레이"], "신발": ["화이트", "레드"], "가방": ["블랙", "화이트"]},
            "빨강": {"하의": ["블랙", "화이트"], "신발": ["화이트", "블랙"], "가방": ["화이트", "블랙"]},
        }
    },
    "여름": {
        "캐주얼": {
            "화이트": {"하의": ["데님 블루", "네이비"], "신발": ["화이트", "블랙"], "가방": ["네이비", "화이트"]},
            "노랑": {"하의": ["화이트", "네이비"], "신발": ["화이트", "베이지"], "가방": ["브라운", "화이트"]},
            "파랑": {"하의": ["화이트", "베이지"], "신발": ["화이트", "블랙"], "가방": ["화이트", "네이비"]},
            "초록": {"하의": ["화이트", "카키"], "신발": ["화이트", "브라운"], "가방": ["베이지", "화이트"]}
        },
        "포멀": {
            "네이비": {"하의": ["화이트", "그레이"], "신발": ["블랙", "브라운"], "가방": ["화이트", "브라운"]},
            "화이트": {"하의": ["블랙", "네이비"], "신발": ["블랙", "실버"], "가방": ["블랙", "네이비"]},
        },
        "스포츠": {
            "블랙": {"하의": ["그레이", "화이트"], "신발": ["블랙", "화이트"], "가방": ["화이트", "실버"]},
            "화이트": {"하의": ["블랙", "네이비"], "신발": ["화이트", "레드"], "가방": ["블랙", "화이트"]},
        }
    },
    "가을": {
        "캐주얼": {
            "베이지": {"하의": ["브라운", "네이비"], "신발": ["브라운", "화이트"], "가방": ["브라운", "카키"]},
            "주황": {"하의": ["브라운", "블랙"], "신발": ["브라운", "화이트"], "가방": ["브라운", "베이지"]},
            "초록": {"하의": ["브라운", "네이비"], "신발": ["브라운", "블랙"], "가방": ["베이지", "브라운"]},
        },
        "포멀": {
            "브라운": {"하의": ["네이비", "블랙"], "신발": ["브라운", "블랙"], "가방": ["브라운", "블랙"]},
            "블랙": {"하의": ["그레이", "브라운"], "신발": ["블랙", "브라운"], "가방": ["실버", "브라운"]},
        },
        "스포츠": {
            "그레이": {"하의": ["블랙", "네이비"], "신발": ["화이트", "브라운"], "가방": ["블랙", "카키"]},
            "블랙": {"하의": ["브라운", "그레이"], "신발": ["블랙", "화이트"], "가방": ["화이트", "브라운"]},
        }
    },
    "겨울": {
        "캐주얼": {
            "블랙": {"하의": ["그레이", "네이비"], "신발": ["블랙", "화이트"], "가방": ["실버", "브라운"]},
            "화이트": {"하의": ["블랙", "네이비"], "신발": ["화이트", "블랙"], "가방": ["블랙", "브라운"]},
            "빨강": {"하의": ["블랙", "그레이"], "신발": ["화이트", "블랙"], "가방": ["실버", "블랙"]},
            "보라": {"하의": ["블랙", "그레이"], "신발": ["화이트", "블랙"], "가방": ["네이비", "실버"]}
        },
        "포멀": {
            "네이비": {"하의": ["그레이", "블랙"], "신발": ["블랙", "브라운"], "가방": ["블랙", "브라운"]},
            "블랙": {"하의": ["그레이", "네이비"], "신발": ["블랙", "화이트"], "가방": ["실버", "브라운"]},
        },
        "스포츠": {
            "그레이": {"하의": ["블랙", "네이비"], "신발": ["화이트", "블랙"], "가방": ["블랙", "화이트"]},
            "블랙": {"하의": ["그레이", "화이트"], "신발": ["블랙", "화이트"], "가방": ["화이트", "실버"]},
        }
    }
}

# 스타일별 기본 팔레트 (선택한 상의 색 조합이 정의되지 않았을 때 사용)
style_defaults = {
    "캐주얼": {"하의": ["데님 블루", "베이지", "화이트"], "신발": ["화이트", "블랙"], "가방": ["브라운", "화이트"]},
    "포멀": {"하의": ["블랙", "네이비", "그레이"], "신발": ["블랙", "브라운", "실버"], "가방": ["블랙", "브라운", "네이비"]},
    "스포츠": {"하의": ["블랙", "그레이", "네이비"], "신발": ["화이트", "블랙", "레드"], "가방": ["블랙", "화이트", "그레이"]},
}

# HTML용 색상 코드 (미리보기용)
color_codes = {
    "화이트": "#FFFFFF", "검정": "#000000", "그레이": "#808080",
    "베이지": "#F5F5DC", "네이비": "#000080", "빨강": "#FF0000",
    "주황": "#FF8C00", "노랑": "#FFD700", "초록": "#228B22",
    "파랑": "#1E90FF", "보라": "#800080", "핑크": "#FFC0CB",
    "브라운": "#8B4513", "카키": "#808000", "데님 블루": "#1E3A5F",
    "실버": "#C0C0C0", "민트": "#98FF98", "레드": "#FF0000"
}

# 날씨 조건별 추가 추천 아이템
weather_items = {
    "맑음": ["선글라스"],
    "흐림": ["얇은 가디건"],
    "비": ["우산", "방수 신발"],
    "눈": ["머플러", "부츠"],
    "덥다": ["반팔 티셔츠"],
    "선선하다": ["얇은 자켓"],
    "춥다": ["두꺼운 코트", "머플러"]
}

# 아이템 추가 여부 옵션
extra_items = {
    "모자": ["볼캡", "버킷햇", "비니"],
    "액세서리": ["시계", "목걸이", "귀걸이"],
    "아우터": ["자켓", "가디건", "코트"]
}

# 퍼스널컬러 보정 팔레트
personal_color_adjustments = {
    "봄웜": ["베이지", "옐로우", "브라운", "핑크"],
    "여름쿨": ["네이비", "하늘색", "라벤더", "화이트"],
    "가을웜": ["브라운", "카키", "올리브", "머스타드"],
    "겨울쿨": ["블랙", "화이트", "레드", "네이비"]
}

# 색상 박스 출력 함수
def color_box(label, color_name):
    color = color_codes.get(color_name, "#FFFFFF")
    st.markdown(
        f"""
        <div style="display:flex; align-items:center; margin:5px 0;">
            <div style="width:30px; height:30px; background-color:{color};
                        border:1px solid #000; margin-right:10px;"></div>
            <span style="color:#000000; font-weight:bold;">{label}: {color_name}</span>
        </div>
        """,
        unsafe_allow_html=True
    )

# 앱 시작
st.title("👗 사계절 옷 코디 전체 추천 앱")
st.write("계절·스타일·상의 색·날씨·퍼스널컬러까지 선택하면 맞춤 코디를 추천해드려요!")

# 사용자 입력
season = st.selectbox("🍂 계절을 선택해주세요:", list(outfit_palette.keys()))
style = st.selectbox("🎯 스타일을 선택해주세요:", list(outfit_palette[season].keys()))
selected_top = st.selectbox("👕 상의 색을 골라주세요:", ALL_TOPS)
weather = st.selectbox("🌤 날씨 조건을 선택해주세요:", list(weather_items.keys()))
extras = st.multiselect("🧢 추가 아이템을 선택해주세요:", list(extra_items.keys()))
personal_color = st.selectbox("🎨 퍼스널컬러를 선택해주세요:", ["봄웜", "여름쿨", "가을웜", "겨울쿨"])

if st.button("✨ 코디 추천받기"):
    # 팔레트 찾기: 지정된 색상이 없으면 스타일 기본 팔레트 사용
    palette = outfit_palette[season][style].get(selected_top, style_defaults[style])

    # 퍼스널컬러 보정 적용
    if personal_color in personal_color_adjustments:
        palette["하의"] = palette["하의"] + personal_color_adjustments[personal_color]
        palette["신발"] = palette["신발"] + personal_color_adjustments[personal_color]
        palette["가방"] = palette["가방"] + personal_color_adjustments[personal_color]

    st.subheader(f"{season} · {style} · {personal_color} 스타일 추천 코디 3세트 ✨")
    for i in range(1, 4):
        bottom = random.choice(palette["하의"])
        shoes = random.choice(palette["신발"])
        bag = random.choice(palette["가방"])

        st.markdown(f"### 👗 코디 {i}")
        color_box("👕 상의", selected_top)
        color_box("👖 하의", bottom)
        color_box("👟 신발", shoes)
        color_box("👜 가방", bag)

        # 날씨 반영
        if weather in weather_items:
            for item in weather_items[weather]:
                st.write(f"🌤 {weather} 추천 아이템: {item}")

        # 추가 아이템 반영
        for extra in extras:
            st.write(f"➕ {extra}: {random.choice(extra_items[extra])}")

        st.markdown("---")

    st.info("👉 계절·스타일·날씨·퍼스널컬러에 맞는 코디 완성!")
